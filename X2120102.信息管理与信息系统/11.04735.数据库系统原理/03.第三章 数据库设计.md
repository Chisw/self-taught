# 第三章 数据库设计

## 第一节 数据库设计概述

数据库设计是将数据库系统与现实世界进行密切地、有机地、协调一致的结合的过程

### 一、数据库的生命周期

1. 数据库分析与设计阶段
  - 需求分析
  - 概念设计
  - 逻辑设计
  - 物理设计

2. 数据库实现与操作阶段
  - 实现
  - 操作与监督
  - 修改与调整

### 二、数据库设计的目标

 满足应用功能需求和良好的数据库性能

### 三、数据库设计的内容

1. 数据库结构设计：静态的，一经形成通常不再改变
2. 数据库行为设计：动态的，确定数据库用户的行为和动作

### 四、数据库设计的方法

1. 直观设计法：依靠经验的原始设计方法，质量难以保证

2. 规范设计法
  - 新奥尔良设计法：注重结构，不太考虑行为，四个阶段：需求分析、概念结构设计、逻辑结构设计、物理结构设计
  - 基于 E-R 模型的数据库设计方法：在需求分析的基础上用 E-R 图构造模式，再转换为特定 DBMS 下的概念模式
  - 基于第三范式的设计方法：在需求分析的基础上确定数据库模式、属性及属性间的依赖关系，再将它们组织到单一关系模式中，再分析模式中不符合第三范式的约束条件，进行模式分解，规范成若干个第三范式关系模式的
集合

3. 计算机辅助设计法：以领域专家的知识或经验为主导，模拟某一规范化设计的方法，通常通过人机交互的方式来完成设计的某些过程

### 五、数据库设计的过程

1. 需求分析阶段
2. 结构设计阶段：概念、逻辑、物理
3. 行为设计阶段：功能、事务、程序
4. 数据库实施阶段：加载、调试
5. 数据库运行和维护阶段

## 第二节 数据库设计的基本步骤

### 一、需求分析

1. 确定数据库范围
  - 考虑应用功能和可拓展性
  - 利用机构与职能关系图进行概念设计的局部化处理和子模式设计

2. 应用过程分析
  - 了解并分析数据与数据处理问的关系
  - 权限和共享范围
  - 借助数据流程图或其他信息及应用结构图形表示

3. 收集与分析数据
  - 了解并分析数据的组成格式及操作特征，每个数据元素的语义及关系等，并将它们收集起来整理归档
  - 静态结构：数据分类表、数据元素表
  - 动态结构：任务分类表、数据操作特征表
  - 数据约束：使用数据时的特殊要求：安全保密性、完整性、响应时间、数据恢复

4. 编写需求分析报告
  - 数据库的应用功能目标
  - 标明不同用户视图范围
  - 应用处理过程需求说明：流程图、任务分类表、数据操作特征表、操作过程说明书
  - 数据字典：数据分类表、数据元素表和各类原始资料

5. 数据量

6. 数据约束

### 二、概念结构设计

在需求分析中产生的需求分析报告的基础上，按照特定的方法设计满足应用需求的用户信息结构

独立于任何软件与硬件

常用方法：实体分析法（自顶向下）、属性综合法（自底向上）

### 三、逻辑结构设计

将概念模型转换为等价的、并为特定 DBMS 所支持数据模型的结构

1. 逻辑结构设计的输入与输出信息
  - **输入**：
  - 独立于特定 DBMS 的概念模型
  - 有关响应时间、 安全保密性、数据完整性及恢复方面的要求说明
  - 数据量及使用频率
  - 特定 DBMS 特性
  - **输出**：
  - 一个特定 DBMS 支持的概念模式，或称之为模式
  - 一个或多个外部视图，或称之为子模式
  - 物理设计说明
  - 程序设计说明

2. 逻辑结构设计的步骤

```
     概念设计
        |
     模型转换
        |
   |-------------|
子模式设计  应用程序设计说明
   |-------------|
        |
     设计评价
        |
     物理设计
```

  - 模型转换：将概念模型等价地转换为特定 DBMS 支持的模型：关系、网状、层次
  - 子模式设计：抽取或导出模式的子集，构造不同用户使用的局部数据逻辑结构
  - 应用程序设计说明：为可实际运行的应用程序设计提供依据与指导，并作为设计评价的基础
  - 设计评价：分析并检验模式及子模式的正确性与合理性

### 四、物理设计

对于一个给定的数据库逻辑结构，研究并构造物理结构的过程

确定数据库在存储设备上的存储结构及存取方法

因 DBMS 的不同还可能包括建立索引和聚集，以及物理块大小、缓冲区个数和大小、数据压缩的选择等

### 五、数据库实施

1. 加载数据：人工（数据的收集、分类、整理），程序（数据的校验、输入）
2. 应用程序设计：前几阶段的完成是程序设计的基础
3. 数据库试运行

### 六、数据库运行和维护

测试后投入生产

维护中最困难的工作是数据库重组与重构：

- 重组：当空间利用率和存取效率下降时进行的，不改变数据库的逻辑结构和物理结构，只是利用 DBMS 提供的设施调整数据库中数据的存储位置，从而回收 “碎片”，使有关联的数据尽可能靠近存放，达到提高空间利用率和数据存取效率的目的

- 重构：指部分修改数据库的逻辑结构或物理结构，这往往因应用需求的改变与拓展或发现当初的设计欠妥而引起的，例如增、删、改数据类型，增、删、改索引与聚集等

## 第三节 关系数据库设计方法

### 一、关系数据库设计过程与各级模式

<img src="../img/X2120102.04735.03.01.png" />

按设计基本步骤，在关系数据库设计的不同阶段，会形成数据库的各级模式

1. 需求分析阶段：综合各个用户的应用需求
2. 概念结构设计阶段：形成独立于机器特点、独立于各个关系数据库管理系统产品的概念模式
3. 逻辑结构设计阶段：将 E-R 图转换成具体的数据库产品文持的关系数据模型，形成数据库逻辑模式，根据用户处理的要求、安全性的考患，在基本表的基础上再建立必要的视图，形成数据的外模式
4. 物理结构的设计阶段：根据关系数据库管理系统的特点和处理的需要，进行物理存储安排，建立索引，形成数据库内模式

### 二、概念结构设计方法

关系数据库通常采用自顶向下法，两个步骤：建立局部信息结构，再将其合成为全局信息结构并优化，使用 E-R 图作为概念模型的描述工具

1. E-R 图的表示方法

概念结构设计就是将需求分析得到的用户需求抽象为信息结构

- 矩形：实体
- 椭圆：属性
- 菱形：联系

常见情形：

- 1）两个实体型之间的联系：一对一、一对多、多对多
- 2）两个以上的实体型之间的联系：1:1、1:N、M:N
- 3）单个实体型内的联系

2. 局部信息结构设计

局部信息结构：根据需求分析报告中标明的不同用户视图范围所建立的满足该范围内用户需求的信息结构

设计步骤：

- 1）确定局部范围：主要依据需求分析报告中标明的用户视图范围来确定
- 2）选择实体：确定的局部范围内选择一些合适的信息单位作为局部信息结构的基本实体
- 3）选择实体的关键字属性
- 4）确定实体间联系
- 5）确定实体的属性：属性分为标识属性（关键字）和说明属性（一般特征）

<img src="../img/X2120102.04735.03.02.png" />

3. 全局信息结构设计

上述步骤中产生的所有局部信息结构合并成为一个全局信息结构

增强数据共享性，控制数据冗余

合并的过程是一个不断发现和解决冲突的过程

- 1）属性冲突：属性域、属性取值单位
- 2）命名冲突：同名异义、异名同义
- 3）结构冲突：同一对象在不同 E-R 图中表现为实体或属性；同一实体属性的个数和类型不同；实体之间的联系在不同的 E-R 图中是不同的类型

<img src="../img/X2120102.04735.03.03.png" />

### 三、逻辑结构设计方法

把在概念结构设计产生的概念模型转换为具体的 DBMS 所支持的逻辑数据模型

#### 1.E-R 图向关系模型的转换

将实体以及实体间的联系转换为关系模式

确定这些关系模式的属性和主码

关系模型的逻辑结构是一组关系模式的集合：将实体、实体的属性和实体间的联系转换为某种关系模式

**转换原则**：

1. 一个实体型转换为一个关系模式
  - 实体的属性作为关系的属性
  - 实体的码作为关系的码

2. 一个一对一（1:1）联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并
  - 如果转换为一个独立的关系模式，则与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，每个实体的码均是该关系的候选码
  - 如果与某一端实体对应的关系模式合并，则需要在该关系模式的属性中加入另一个关系模式的码和联系本身的属性

3. 一个一对多(1:N）联系可以转换为一个独立的关系模式，也可以与 N 端对应的关系模式合并
  - 如果转换为一个独立的关系模式，则与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，而关系的码为 N 端实体的码

4. 一个多对多（M：N）联系转换为一个关系模式
  - 与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，而关系的码为各实体码的组合

5. 三个或三个以上实体间的一个多元联系可以转换为一个关系模式
  - 与该多元联系相连的各实体的码以及联系本身的属性均转换为关系的属性，而关系的码为各实体码的组合

6. 具有相同码的关系模式可合并

#### 2.数据模型的优化

1. 确定各属性间的函数依赖关系
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系
3. 判断每个关系模式的范式，根据实际需要确定最合适的范式
4. 按照需求分析阶段得到的处理要求，分析这些模式对于这样的应用环境是否合适，确定是否要对某些模式进行合并或分解
5. 对关系模式进行必要的分解，提高数据操作的效率和存储空间的利用率

#### 3.设计用户子模式

1. 通过视图机制在设计用户视图时，制定别名，方便使用
2. 对不同级别的用户定义不同的视图，以保证系统的安全性
3. 简化用户对系统的使用，缓存复杂查询为视图

### 四、物理设计方法

关系数据库系统的优点之一是用户通常不需要进行数据存储结构和存取方法的设计

1. 建立索引
  - 存在额外开销
  - 建立索引的数据对象通常应具有较少的插入、修改和删除操作
  - 用以建立索引的那些属性也应是其所在关系中使用频率较高的属性
  - 静态：人员预先建立，多适合于用户较多且使用周期相对较长的数据
  - 动态：应用人员在程序内外临时建立索引，它多适合于单独用户或临时性使用要求情况

2. 建立聚集
  - 將相关数据集中存放的物理存储技术
  - 借以提高 I/O 的数据命中率而改善存取速度，功能由具体的 DBMS 提供
  - 块结构方式，块与块之间由指针连接，一个块对应于个物理分区
  - 数据使用频率较高的数据才有必要建立聚集，数据量通常也较大，且更新操作应较少

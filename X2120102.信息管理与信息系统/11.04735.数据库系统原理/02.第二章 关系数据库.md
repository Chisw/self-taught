# 第二章 关系数据库

## 第一节 关系数据库概述

- 20 世纪六七十年代的理论基础
- 20 世纪 70 年代末的 System R
- 20 世纪 80 年代关系模型逐渐成熟，出现了 Oracle， Sybase, SQL Server

## 第二节 关系数据模型

### 一、关系数据结构

只包含单一的数据结构，即关系

1. 表 Table：又称为关系，表名、构成表的各列、若干行数据
2. 关系 Relation：基本关系（基本表、基表，实际表）、查询表（结果表）、视图表（导出表、虚表）
3. 列 Column：又称为字段、属性
4. 属性 Attribute：属性的个数称为关系的元或度，列的值称为属性值，取值范围称为值域
5. 行 Row：又称为元组 Tuple 或记录 Record，表中的数据是按行存储的
6. 元组 Tuple
7. 分量 Component：元组中的一个属性值
8. 码或键 Key：能标识唯一性的属性
9. 超码或超键 Super Key：移除某个属性后仍能标识唯一性的键码
10. 候选码或候选键 Candidate Key：↑，不能移除
11. 主码或主键 Primary Key
12. 全码或全键 All-Key：属性集合为主码或主键时
13. 主属性 Primary Attribute：包含在候选码中的属性
13. 非主属性 Nonprimary Attribute：不包含在候选码中的属性
14. 外码或外键 Foreign Key：关系中的某个属性非当前主码或候选码，而是另一关系的主码时
15. 参照关系 Referencing Relation：又称为从关系，以外码相关联的两个关系
15. 被参照关系 Referenced Relation：又称为主关系，外码为其主码
16. 域 Domain：属性值范围
17. 数据类型 Data Type
18. 关系模式 Relation Schema：数据库也有“型 type” 和 “值 value”之分
  - 关系数据库中，型：关系模式，值：关系
  - 关系模式是对关系的描述
  - 关系模式是静态的，关系是动态的
19. 关系数据库 Relation Database
  - 以关系模型作为数据的逻辑模型，并采用关系作为数据组织方式，建立在关系代数的基础上

尽管关系模型的数据结构表示为二维表，但不是任意的一个二维表都可以作为一个关系

关系数据库对关系是有限定的：

1. 属性不可分解，不可表中表
2. 关系仅有一种关系模式，每一关系模式中的属性的数据类型、个数相对固定
3. 属性在关系中必须有唯一性命名
4. 同关系中不允许出现候选码或候选键值完全相同的元组
5. 元组顺序可换
6. 属性顺序可换

### 二、关系操作集合

1. 基本的关系操作
  - 常用包括：查询 Query、插入 Insert、删除 Delete、修改 Update
  - 查询表能力很强，又分为：选择、投影、连接、除、并、差、交、笛卡尔积等
  - 是一种集合操作，又称为一次一集合方式 set-at-a-time

2. 关系数据语言的分类
  - 优点：高度非过程化（用户无须请求管理员建立专门存取路径，也不必借助循环和递归来完成重复操作）
  - 操作能力分为两种方式：代数方式（逻辑代数）、逻辑方式（关系演算：元组关系演算、域关系演算）
  - 关系数据语言可分为三类：关系代数语言、关系演算语言、兼具前两者特点的结构化查询语言 SQL

3. 关系代数
  - 以集合代数为基础发展起来的
  - 任何一种操作都是将一定的操作符作用于一定的操作对象上，得到预期的操作结果
  - 因而操作包含三大要素：操作对象、操作符、操作结果
  - 关系代数操作中，操作对象和操作结果都是关系，操作符包括：集合运算、专门的关系运算符

```
集合运算符
  ∪  并 Union
  ∩  交 Intersection
  -  差 Difference
  ×  笛卡尔积 Cartesian Product

专门关系运算符
  σ  选择 Select
  π  投影 Projection
  ⋈  连接 Join
  ÷  除 Division

比较操作符
  ＞
  ≥
  ＜
  ≤
  ＝
  ≠

逻辑操作符
  ¬  非
  ⋀  与
  ⋁  或
```

关系代数表达式：关系代数操作经过有限次复合的式子

IBM 的 ISBL 是一个纯代数数据操作语言实现

#### A.传统的集合运算

为二目运算，将关系看成是元组的集合，从水平的行角度进行

#### B.专门的关系运算

涉及行和列，分为一元（垂直分解的投影运算、水平分解选择运算）、二元（连接运算、除运算）

### 三、关系的完整性约束

完整性：正确性、相容性、一致性

两个方面：现实世界中应用需求、数据库内数据之间

关系模型中有三类完整性约束：

前两者是关系模型必领满足的完整性约束条件（关系的两个不变性），由关系数据库管理系统（RDBMS）自动支持（自动检查完整性）

后者包括：域完整性约束和其他约束（应用领域需要遵循的对属性值域约束条件和业务规则）

1. 实体完整性约束 Entity Integrity Constraint
  - 关系的主属性，即主码的组成不能为空 NULL
  - 关系对应于现实世界中的实体集，而现实世界中的实体是可区分的

2. 参照完整性约束
  - 定义外码和主码之间的引用规则
  - 是对关系间引用数据的一种限制

3. 用户定义完整性约束
  - 针对某一应用环境的完整性约束条件

关系模型完整性约束的检验：

1. 插入操作
  - 检查主码是否存在
  - 检查各个属性值是否为空
  - 检查外码是否在参照关系中存在
  - 域检查和其它检查

2. 删除操作
  - 检查是否为被参考关系中的行，否：直接删除，是：拒绝删除、空值删除（参考关系改空再删）、级联删除

3. 更新操作
  - 可分解为先执行删除，再执行插入

## 第三节 关系数据库的规范化理论

### 一、关系模式中可能存在的冗余和异常问题

设计的角度看，关系模式有好坏之分

1. 数据冗余：同一数据反复存储
2. 更新异常：数据冗余导致空间浪费和潜在的数据不一致
3. 插入异常
4. 删除异常

### 二、函数依赖与关键字

函数依赖：关系中属性间的对应关系

R 中 X 有唯一对应值 Y，X 函数决定 Y，Y 依赖于 X， X -> Y，X 称为决定因素

分为：完全函数依赖、部分函数依赖、传递函数依赖


### 三、范式与关系规范化过程

关系数据库中的关系需要满足一定的要求，不同程度的要求称为不同的：范式 Normal Form

满足最低要求的称为第一范式，逐级递增

**规范化过程**：低一级范式 关系模式 通过 模式分解（Schema Decomposition）转换为 若干个 高一级范式 关系模式 的 集合

关系型数据系统中所有关系结构都必须是规范化的，至少是第一范式

但实际应用中很多数据格式都不是第一范式的，因此在数据库逻辑设计中需要将非规范化的结构转换为规范化的关系

同时为减少数据库中的数据冗余，增强数据的易操作性，消除数据插入、删除异常等现象，要求数据库中的每个关系都必须满足一定的规范条件

以结构更单纯、更规则的关系逐步取代原有关系

1. 第一范式
  - 关系中每个列与行的交点处的取值都是不可再分的基本元素，则为第一范式
  - 不满足则为**非规范关系**

2. 第二范式
  - 关系为 1NF，且所有非主属性都完全函数依赖于候选关键字

3. 第三范式
  - 关系为 2NF，且其每一个非主属性都不传递函数依赖于候选关键字

4. 改进范式 BCNF (Boyce-Codd Normal Form)
  - 关系为 3NF，X，Y 为其属性集，F 为其依赖集，F 中所有函数依赖 X -> Y（Y 不属于 X）中的 X 必包含候选关键字
  - 简言之，若关系中每一函数依赖的决定因素都包含一个候选关键字，则为 BCNF，决定因素可以是单一属性或组合属性

### 四、关系规范化理论的应用

主要应用于数据库设计中的概念设计阶段，对所产生的概念设计

可用它来分析其实体划分是否适合，判断属性分配到哪个实体中更为合理

在实现设计中当将 E-R 图向关系模型转换时，还可以用它来分析并发现概念设计中可能存在的遗漏或不当之处

特别是联系实体是否不单独转换为一独立关系，而集成到与之相联的基本实体中去处理时，规范化理论是最有效的评价准则

# 第三章 网络协议和体系结构

## 第一节 网络协议和体系结构概述

### 一、网络协议的概念

从硬件来看，只要有终端、信道和交换设备，就能使两个用户建立起连接，但要实现信息交换是不够的，需要制定规定

双方必须遵守的规则和约定称为协议或规程

包括：

1. 语法：如何讲，确定数据格式、数据码型、信号电平
2. 语义：讲什么，确定协议元素的类型，发出的控制信息、执行的返回动作、返回的应答
3. 时序关系：规定执行的顺序，确定通信状态的变化、正确的应答

### 二、分层的思想

从底层信号到完整数据分组中，技术复杂、涉及广泛，很难在一个协议中全部完成

将复杂功能由若干协议分别完成，再将其按一定方式组织起来，最典型的采用**分层方式**

核心思路：上层的功能建立在下层功能基础上，每层遵守一定的通信规则

优势：

1. 各层次之间可相互独立
- 高层无须了解底层的工作机制、使用设备和技术细节，需要低层通过接口提供哪些服务
- 每层的功能、任务清晰明确，且相对独立

2. 较强灵活性，便于实现和维护
- 整体规划、设计需要考虑十分周到
- 层次划分后，被分解成若干更容易处理的部分
- 单个领域更易发展，变化后也不会影响其他层

3. 有利于标准化
- 界定后可围绕确定的功能和服务制定相应的标准

### 三、网络体系结构

层次和协议的集合构成了网络的体系结构

其研究的是网络系统各部分的组成及其相互关系

完整的体系结构应该包括整个计算机网络的逻辑组成和功能分配，定义和描述了用于计算机及其通信设施之间互联的标准和规范的集合，以便在统一的原则指导下进行计算机网络的设计、构造、使用和维护

一种体系结构应当具有足够的信息，以允许软件设计人员给每个层次编写实现该层协议的有关程序，即通信软件，

- 1960s IBM SNA Systems Network Architecture
- DEC DNA Digital Network Architecture

目前典型的层次化体系结构有 OSI、TCP/IP

## 第二节 OSI 参考模型

1984 ISO 吸取 SNA 及其他网络体系结构，提出了开放系统互连 OSI (Open System Interconnection) 参考模型 (OSI/RM)，简称 OSI 模型

所谓开放、指按照这个标准设计和建成的数据通信网中的设备都可以互相通信

### 一、OSI 参考模型各层的功能

采用分层结构化技术分为 7 层

上 4 层主要完成信息处理服务功能，称为网络高层，端到端层

下 3 层主要完成数据交换和数据传输，称为网络低层，即通信子网，结点到结点层

低层与高层之间由第 4 传输层街接

中间系统（比如路由器）通常只实现下 3 层，物理层端到端通信：实通信

```
应用层
  |
表示层
  |
会话层
  |
传输(运输)层
  |
网络层
  |
数据链路层
  |
物理层
```

1. 物理层
- 在传输介质上实现无结构比特流传输
- 不关心实际内容，只关心如何将 0、1 以合适信号传送
- 需要实现信号编码功能
- 规定数据终端设备(DTE)、通信设备(DCE)间的接口，包括机四个方面：
  - 机械：物理特性，接口的形状、尺寸、插脚、排列方式
  - 电气：电路特性，电平大小、接收器发送器电路特性、信号识别、最大传输速率
  - 功能：各信号线用途，功能分类
  - 规程：指明传输全程及事件发生的顺序、传输方式
- 典型的有：RS-232、RS-449

2. 数据链路层
- 主要是在相邻结点间传输数据
- 物理传输难免出错，为实现差错控制，采用“帧”为单位的数据块传输方式
- 需要相应的帧同步技术，数据链路层的“成帧（帧同步）”，包括
  - 定义帧的格式、类型、成帧方法
- 功能：
  - 数据吗附加循环码实现链路层差错控制
  - 实现相邻结点间的流量控制
  - 链路管理
  - **寻址**：确保每帧准确传送到正确处，接收方也应该知道发送方的地址，在广播介质网络中尤为重要，比如局域网中广泛采用 MAC 地址

3. 网络层
- 解决如何将分组通过交换网络传送至目的主机
- 主要功能是数据转发、路由
- 源结点、中继结点、目的结点构成了路径
- 结点间有多条路径可选，此路由选择是网络层的要完成主要功能之一
- 还要控制通信量，避免网络性能下降
- 与链路层类似，也具备寻址功能，确保分组正确传输，比如 IP 地址

4. 传输层
- 是第一个端到端的层次，也是进程-进程层次
- 数据通信表面是在两台主机间进行，实质上是在两个主机的进程之间
- 物理、链路、网络三层可组成公共网络，被多设备共享，且计算机-结点机、结点机-结点机是按照“接力〞方式传送
- 为了防止传送途中报文的丢失，两个主机的进程之间需要实现端到端控制
- 传输层的功能主要包括复用/解复用（区分发送和接收主机上的进程）、端到端的可靠数据传输、连接控制、流量控制和拥塞控制机制等

5. 会话层
- 指用户间连接，通过两台计算机间建立、管理和终止通信来完成对话
- 主要功能：
  - 建立会话时核实双方身份是否有权参加会话
  - 确定何方支付通信费用
  - 双方在各种选择功能方面（如全双工还是半双工通信）取得一致
  - 在会话建立以后，需要对进程问的对话进行管理与控制
- 实际中，会话层的功能已经被应用层覆盖，很少单独存在

6. 表示层
- 主要处理应用实体间交换数据的语法，解决格式和数据表示的差别
- 为应用层提供一致的数据格式，从而使字符、格式等有差异的设备之间相互通信
- 还可实现文本压缩、解压缩，数据加密、解密，字符编码转换
- 此层某些实际数据通讯网络中也是由应用层实现，不独立存在

7. 应用层
- 与提供给用户丰富的网络服务相关：文件传送、电子邮件和 P2P 应用等
- 应用层为用户提供了一个应用网络通信的接口

### 二、OSI 参考模型的有关术语

每层真正功能是为上层服务

1. 数据单元
- 层实体间传送的比特组称为数据单元
- 对等层间传输按本层协议进行，此时称为协议数据单元
- PDU 在不同层往往有不同的叫法
  - 物理层中：位流或比特流
  - 数据链路层中：帧
  - 网络层中：分组或包
  - 传输层中：数据段或报文段
  - 应用层中：报文

2. 服务访问点
- 邻层间服务通过接口面的服务访问点（SAP Service Access Point）进行
- 每个 SAP 有唯一地址号码

3. 服务原语
- 邻层间服务的提供、请求提供都是用一组原语（Primitive）描述的：
  - 请求 Request
  - 指示 Indication
  - 响应 Response
  - 确认 Confirm

4. 面向连接和无连接
- 分层体系结构中，下层向上层提供服务的两种形式
  - 面向连接：电话系统，建立连接、发送数据
  - 无连接（数据报 Datagram）：邮件发送，没有建立和拆除链路的过程

## 第三节 TCP/IP 参考模型

OSI 跟多是一种理论上的体系结构，实际数据通信网络中， Internet 体系的 TCP/IP 更具有现实意义

### 一、TCP/IP 的产生

阿帕网之际，不同软硬件构成的计算机通信困难

以 Vinton G. Cerf 和 Robert E. Kahn 两位为首的研修小组，1970 NCP、1974 TCP、1978 IP 抽离自 TCP，TCP 正式变为 TCP/IP

TCP 负责发现传输问题，一有问题就发出信号，要求重新传输，直到所有数据安全正确传输至目的地

IP 给每一台计算机规定一个地址，从而实现准确传输

1983.1.1 NCP 停止使用，TCP/IP 作为互联网上所有主机间的共同协议开始运行

### 二、TCP/IP 参考模型及其功能介绍

1. 应用层
- 将 OSI 中的**会话层**和**表示层**合并到**应用层**
- 用户通过应用层来使用各种服务：WWW、文件传输、电子邮件
- 各应用使用相应的协议来封装数据：HTTP、FTP、SMTP POP3
- 每层应用协议都会使用：面向连接传输控制协议 TCP 或 无连接用户数据包协议 UDP

2. 传输层
- 应用层封装后，由传输层协议负责传输
- 逻辑通信：两个进程之间的通信就像所在的两个主机存在直接连接一样，实际上，主机间可能相距很远，两者的物理连接可能经过了多个交换机/路由器，传输路径可能由不同类型的物理链路组成
- 利用逻辑通信机制，两个进程可以不用考虑两者之间的物理连接方式而实现发送/接收消息
- 传输层协议可解决端到端可靠性、保证数据按照正确的顺序到达等问题
- 传输层负责在**网络层**和**应用层**之间传递消息，不涉及消息如何在网络中传输，交由网络互联层去解决
- 主要包括面向连接、提供可靠数据流传输的传输控制协议（TCP） 和无连接、不提供可靠数据传输的用户数据报协议 (UDP)

3. 网络互联层
- 为 TCP/IP 的核心，将数据分组发往目的网络或主机
- 过程中，要为分组的传输选择相应的路径 (路由选择），完成分组转发，提供网络层寻址 IP 地址
- 网络互联层除了需要完成路由的功能外，也可以完成将不同类型的网络（异构网）互联的任务
- 网络互联层的核心协议是 IP，负责定义分组的格式和传输
- IP 是无连接不可靠网络协议，因此 IP 分组到达的顺序和发送的顺序可能不同，并且可能存在分组丢失现象
- 网络互联层还包括互联网控制报文协议(ICMP）、互联网多播组管理协议（ICMP)，以及路由协议，如BCP、OSPF 和 RIP 等

4. 网络接口层
- 实际上 TCP/IP 没有真正描述这一层的实现，只要求能够提供给其上层网络互联层一个访问接口，以便在其上传递 IP 分组
- 末被定义，所以其具体的实现方法将随着网络类型而变化
- 这一层包括 OSI 参考模型中的**数据链路层**和**物理层**，不同网络类型将上层的 IP 分组封装到数据帧中，实现有关的链路控制功能，最终以比特流的形式在不同的传输介质上进行传输
- 在实际的数据通信过程中，用户的数据在应用层以报文的形式开始向下一层进行封装，形成：段、数据报、帧，最后以比特流的形式进行传输
- 在中间结点处，例如路由器、交换机等，分别从对应的数据报、帧中取出并对相应的路由、地址信息进行处理
- 送达目的主机后由下层到上层开始逐层处理，并去掉相应的头部信息，最终还原为最初的报文

### 三、TCP/IP 与 OSI 的区别

两者都是按分层的思想对计算机网络进行模块化设计，区别包括：

1. 层侧划分不同：OSI 7，TCP/IP 4，两者都有网络层、传输层、应用层；后者没有表示层、会话层（合并至应用层），将物理层和数据链路层合并至网络接口层
2. 面向连接和面向无连接的通信不同：OSI 在网络层支持两种，在传输层仅支持面向连接；TCP/IP 在网络层仅支持面向无连接，在传输层支持两种
3. 与具体协议的配合程度：OSI 设计在具体协议前，有很好的通用性，但很多功能不知道放在那一层；TCP/IP 相反，所以对协议配合更好

## 第四节 TCP 和 UDP

TCP/IP 是 Internet 的基础框架，其中主要包含：
- 网络互联层的网络互连协议 IP
- 传输层的传输控制协议 TCP
- 用户数据报协议 UDP
- 应用层的域名系统 DNS
- 超文本传输协议 HTTP
- 文件传输协议 FTP

### 一、TCP/IP 中的传输层

传输层的主要功能：
- 为应用进程之间提供端到端的逻辑通信
- 通常还对收到的报文进行差错检测
- 某些传输层协议进行端到端的数据传输可控性控制
- 针对应用层实现复用与解复用(Multiplexing/ Demuliplexing）

TCP/IP 中规定了两种不同的传输层协议：
1. 面向连接的传输控制协议 TCP
2. 无连接的用户数据报协议 UDP

不同主机、系统上的应用进程间通信，必须用统一的寻址方法：传输层使用协议端口号 Protocol Port Number，简称端口 Port

Internet 中，一台拥有 IP 地址的主机可以提供许多服务：Web、FTP、邮件，这些服务使用不同的进程，但都使用同一个 IP

因而使用 IP 区分网络服务是不够的，需使用“IP 地址 + 端口号”

端口号是一个 16 位的二进制整数，根据端口号大小可分为：
- 熟知端口：0~1023，固定分配给一些服务，21 FTP、25 SMTP、80 HTTP、135 RPC
- 注册端口：1024~49151，为没有熟知端口号应用使用，须在 IANA 登记，以防重复
- 客户端口：49152~65535，客户进程选择暂时使用

传输层提供无连接与面向连接两类服务：
- 无连接服务是指数据传输之前无需与对端进行任何信息交换，即“握手”，直接构造数据分组，直接发送出去
- 面向连接服务是指在数据传输之前，需要交换一些控制信息，建立连接（逻辑连接），然后再传输数据，数据传输结束后还需要再拆除连接

Internet 网络提供无连接服务的传输层协议是 UDP，提供面向连接服务的传输层协议是 TCP

### 二、UDP

传输层无连接的用户数据报协议

是一个不可靠协议，非常适合对于速率要求高、而对精确度要求相对较低的网络应用，如各种多媒体实时业务，视频会议、视频点播和网络电话等

```
首部：源端口号、目的端口号、长度、检验和
 +
应用数据
```

使用端口号为不同的应用保留其各自的数据传输通道，从而支持同一时刻内多项应用同时发送和接收数据

应用可以使用静态、动态端口，首部使用两个字节存放端口号，范围：0~65535

**长度**指包括**首部**和**数据部分**在内的总字节数，首部的长度固定，所以主要被用来计算可变长度的数据部分（又称为数据负载）

**检验和**保证数据安全

工作机制主要包括：

1. 传送数据时就从应用抓取并尽快发送至网络
- 发送端速度受限于应用数据生成速度、计算机能力、传输带宽
- 接收端将每个消息段放在队列，应用依次从队列读取

2. 不需要维护连接状态
- 包括收发状态等
- 因此服务机可同时向多个客户机传输相同的消息

3. 数据报的首部很短
- 8 字节 相对于 TCP 20 字节，额外开销很小

4. 吞吐量不受拥塞控制算法的调节
- 只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制

5. 使用最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的连接状态表

6. 面向报文
- 发送方的 UDP 对应用程序交下来的报文，在添加首部后就向下交付给 IP 层
- 不拆分不合并，保留些报文边界，应用程序需要选择合适的报文大小

### 三、TCP

Transmission Control Protocol 传输控制协议

一种面向连接的、可靠的、基于字节流的传输层通信协议

由 IETF 的 RFC 792 定义，在 TCP/IP 中，位于应用层之下，网络互联层之上

IP 不提供可靠通信，因此需要 TCP 传输控制

- 应用层向 TCP 层发送用于网间传输的、用字节表示的数据流
- TCP 把数据流分成适当长度的报文段
- 通常受该计算机连接的网络的数据链路层的最大传输单元 MTU 的限制
- TCP 把结果数据报传给网络互联层的 IP，由它来通过网络将数据报传送给接收端实体的 TCP
- TCP 为了保证不发生数据报丢失，给每个数据报一个序号，序号也保证了传送顺序
- 接收端实体对已成功收到的数据报发回一个相应的确认 (ACK)
- 发送端实体在合理的往返时延（RTT）内未收到确认，那对应数据报就被假设为已丢失，将被重传
- TCP 用一个检验和函数来检验数据是否有错误，发送、接收时都要计算检验和

#### 结构

1. 源端口号、目的端口号各占 16 位

2. 序号、确认序号各占 32 位
- 对每个应用层数据的每个字节进行编号，每个 TCP 段的序号是该段所封装的应用层数据的第一个字节的序号
- 确认序号是期望从对方接收的字节序号，该序号对应的字节尚未收到，该序号之前的字节已被全部正确接收，TCP 采用累积确认机制

3. 首部长度占 4 位

4. 保留字段占 6 位

5. URG、ACK、PSH、RST、SYN、FIN 各占 1 位
- URG=1：紧急指针字段有效，通知系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据）
- ACK=1：标识确认号字段有效，当 ACK=0时，确认号无效
- PSH=1：尽快地交付接收应用进程，不再等到整个缓存都填满了后再向上交付
- RST=1：TCP 连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接再重建
- SYN=1：建立新连接请求控制段或者是同意建立新连接的确认段
- FIN=1：TCP 段的发送端的数据已发送完毕，请求释放TCP 连接

6. 窗口字段占16位，用于向对方通告接收窗口大小（单位为字节），其值是本端接收对方数据的缓存剩余空间，用于实现 TCP 的流量控制

7. 检验和字段占 16 位，检验和字段检验的范围类似于 UDP，包括了 TCP 首部和应用层数据

8. 紧急指针字段占 16 位，指出在本报文段中紧急数据共有多少个字节（紧急数据放在本报文段数据的最前面）

9. 选项字段（长度可变)
- TCP 最初只规定了一种选项，即最大段长度 MSS，用于通告对方 TCP：“我的缓存能接收的数据段的最大长度是MSS 个字节”，注意 MSS 只计数应用层数据字节数，不包括段首部
- 窗口扩大选项（占3B），其中一个字节表示移位值 S，新的窗口值等于 TCP 首部中的窗口位数增大到（16+S)，相当于把窗口值向左移动 S 位后获得实际的窗口大小
- 时间戳选项（占 10B)，其中最主要的是字段时间戳值宇段（4B） 和时间戳回送回答宇段（4B)
- 选择确认 (SACK）选项，TCP 默认采用累积确认机制，如果要使用选择确认，那么在建立 TCP 连接时，就要在TCP 首部的选项中加上“允许 SACK〞 的选项，并且双方必须事先商定好

10. 填充字段，长度为0~3个字节，取值全为0，为的是使整个首部长度是4B 的整数倍

#### 连接管理

TCP 是面向连接的传输协议，其连接功能是通过 TCP 的连接管理实现的

TCP 连接管理包括连接建立、数据传输和连接拆除 3 个阶段

TCP 连接建立过程中要解决以下 3 个问题：
1. 要使通信的双方能够确知对方的存在
2. 要允许双方协商通信过程中的相关参数
3. 能够对传输实体的资源进行分配

TCP连接的建立采用客户/服务器方式

主动发起连接建立的应用进程为客户，被动等待连接建立的应用进程为服务器

#### 建立连接三次握手

TCP 连接的建立过程可以形象地描述为三次握手

假设 A 主机运行客户程序，B 主机运行服务器程序，则建立连接的过程如下

1. A 的 TCP 向 B 发出连接请求报文段
- 其首部中的同步位`SYN=1`，并选择初始序号`seq=x`，表明传送数据的第一个字节的序号是 x

2. B 的 TCP 收到连接请求报文段，如同意，则发回确认
- B在确认报文段中应使`SYN=1`，`ACK =1`，其确认序号`ack_seq=x+1`，自己选择的初始序号`seq=y`

3. A 收到此确认报文段后向 B 给出确认
- 其中`ACK =1`，`SYN=0`，`seq=x+1`，`ack_seq=y+1`

注意：第一、二次握手段不携带数据，第三次握手段可以携带数据
- A 给 B 发送数据的第一个字节序号为`x+1`
- B 给 A 发送数据的第一个字节的序号为`y+1`，即`SYN=1`的段会空耗一个序号

#### 拆除连接四次握手

连接建立完成后，进行数据传送后，还需要进行连接拆除，需要经过 4 次握手过程

1. TCP 通信的双方都可以拆除连接
- 假设拆除连接由 A 发起，则 A 向 B 发送释放连接控制报文段，并停止再发送数据
- 控制报文段首部中的终止控制位 FIN 位置为 1，其序号`seg=u`，然后 A 等待 B 确认

2. B 收到 A 发出的释放连接控制报文段后，立即向 A 发送确认报文段
- 确认报文段的`ACK=1`，确认序号`ack_seq=u+1`，设确认报文段自己的序号`seg=v`
- A 收到来自 B 的确认后，进入等待状态，等待 B 发出的释放连接控制报文段

3. 如果 B 已经没有要向 A 发送的数据，则 B 向 A 发送释放连接控制报文段
- 其首部中`FIN=1`，假设此时 B 要发送的报文段序号`seg=w`，而确认序号`ack_seq=u+1`

4. A 收到 B 释放连接控制报文段后，要向B发送确认报文段
- 其中`ACK=1`，序号`seq=u+1`，确认序号`ack_seq=w+1`
- B 收到该确认报文段后，可以马上释放连接
- A 在发出该确认段后，延迟一段时间即释放连接

#### 可靠传输工作机制

1. 应用数据被分割成 TCP 认为最适合发送的数据块
- 这和 UDP 完全不同，应用程序产生的数据长度将保持不变
- 由 TCP 传递给 IP 的信息单位称为报文段或段 Segment

2. 当TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段
- 如果不能及时收到一个确认，则认为该报文段丢失，重发报文段
- 当 TCP 收到发自 TCP 连接另一端的数据时，它将发送一个确认

3. TCP 首部中设有检验和，用于检测数据在传输过程中是否发生变化
- 如有差错，将丢弃这个报文段并不确认收到(希望发送端超时并重发）

4. 如果必要，TCP 将对收到的数据进行重新排序交给应用层
- TCP 报文段作为 IP 数据报来传输，而 IP 数据报的到达可能会经过不同的路径，造成乱序

5. 网络延迟、重传机制造成接收端收到重复报文段，接收端丢弃重复

6. TCP 能够提供流量控制
- TCP 连接的每一方都有固定大小的缓冲空间
- TCP 的接收端只允许另一端发送接收端缓冲区所能接纳的数据
- 这将防止较快主机致使较慢主机的缓冲区溢出

#### 流量控制 Flow Control

目的是使发送端的数据发送速率不要太快，确保接收端能够来得及接收，即接收端的数据缓存不会溢出

接收端(接收端与发送端是相对的，因为 TCP 全双工）在给发送端发送数据段(ACK =1）或单纯确认段时，通告剩余接收缓存空间作为接收窗口，发送端在接下来发送数据段时，控制未确认段的应用层数据总量不超过最近一次接收端通告的接收窗口大小，从而确保接收端不会发生缓存溢出

#### 拥塞控制 Congestion Control

从端到端的角度推测网络是否发生拥塞

如果推断网络发生拥塞，则立即将数据发送速率降下来，以便缓解网络拥塞

TCP 的拥塞控制采用的也是窗口机制，通过调节窗口的大小实现对数据发送速率的调整

TCP 的发送端维持一个称为拥塞窗口 cwnd 的变量，单位为字节，表示在未收到接收端确认的情况下，可以连续发送的数据宇节数

cwnd 的大小取决于网络的拥塞程度，动态地发生变化

拥塞窗口调整的原则是：只要网络没有出现拥塞，就可以增大拥塞窗口，以便将更多的数据发送出去，相当于提高发送速率；一旦网络出现拥塞，拥塞窗口就减小一些，减少注入网络的数据量，从而缓解网络的拥塞

发送端判断网络发生拥塞的依据是：发送端设置一个重传计时器 RTO，对于某个己发出的数据报文段，如果在 RTO 计时到期后，还没有收到来自接收端的确认，则认为此时网络发生了拥塞

TCP 的拥塞控制算法包括：

1. 慢启动（Slow Start）
- 作用在 TCP 数据传输的开始阶段
- 主机开始发送数据时，不知道网络负荷情况，立即发送大量的数据会引起网络的拥塞
- 刚开始发送时，先将拥塞窗口 cwnd 设置为 TCP 最大段长度 MSS 的值
- 每收到一个数据报文段的确认后，cwnd 就增加一个 MSS 的数值
- 试探性的逐渐增大发送端的拥塞窗口，使数据注入网络的速率比较合理
- 如果定义从发送端发出一个数据报文段到收到这个数据报文段的确认的时间间隔为往返时间 RTT，则在慢启动阶段，每经过一个 RTT，cwnd 的值就加倍

2. 拥塞避免（ Congestion Avoidance )
- 为了防止拥塞窗口增长过快而引起网络拥塞，TCP 还需要设置一个慢启动阈值 ssthresh
- 当拥塞窗口的值增加到 ssthresh 时，就要减缓拥塞窗口的增长速度
- 每经过一个 RTT，拥塞窗口 cwnd 的值加1（单位为 MSS)
- 这样就可以使 cwnd 按线性规律缓慢增长，这个过程称为“加性增加”（Additive Inerease）算法
- 通常拥塞窗口 cwnd 的初值被设置为 1，慢启动阈值 ssthresh 的初值被设置为 16
- 当拥塞避免算法执行到某个时刻，发送端在规定时间内没有收到接收端的确认，即发生了网络超时，则意味着网络发生了拥塞
- 此时，发送端首先将 ssthresh 的值变为发生超时时cwnd 值的一半，同时将 cwnd 的值置为 1，重新执行慢启动算法
- 好处是当网络频繁出现拥塞时，ssthresh 下降得很快，可以大大减少注入网络中的数据报文段
- 通常称这个过程为 “乘性减小”(Mutiplicative Decrease）算法
- TCP 中的 “加性增加〞和“乘性减小〞算法合起来称为 AIMD 算法
- 慢启动和拥塞避免是 1988 年提出的，1990 年在此基础上又增加了快速重传和快速恢复

3. 快速重传(Fast Retransmit）
- 基本思想是：接收端每收到一个失序的数据报文段后就立即发出重复确认，以便更早地通知发送端有丢包的情况发生
- 快速重传算法中规定，如果收到某数据报文段的 3 个重复确认，则立即重传下一个数据报文段

4. 快速恢复（Fast Recovery）
- 是配合快速重传使用的算法，其基本思想是：当发送端连续收到了个重复确认时，就将慢启动阈值 ssthresh 减半，以预防网络拥塞的发生
- 并且将拥塞窗口 cwnd 的值置为减半后的 ssthresh，然后开始执行拥塞避免算法，使得 cwnd 缓慢地加性增大

## 思考与练习

1. 网络协议包括的三要素是什么？
2. 在计算机网络中使用分层的思想有哪些好处？
3. 什么是网络体系结构？网络体系结构研究的对象是什么？
4. 简述 OSI 参考模型的层次划分。
5. 简述 OSI 参考模型的物理层、数据链路层、网络层、传输层和应用层的主要功能。
6. OSI 参考模型的服务原语有哪些类型？各种类型原语的功能是什么？
7. 数据通信中，面向连接的服务和无连接的服务含义各是什么？
8. 简述 TCP/IP 参考模型的层次划分，以及与 OSI 参考模型的主要区别。
9. HTTP、SMTP、 FTP、UDP、 TCP、IP、ICMP 和 OSPF 等协议分别属于 TCP/IP 参考模型的哪个层次？
10. 分别指出 TCP/IP 中的熟知端口、注册端口和客户端口的端口号范围。
11. 简述 UDP 的数据报结构和主要工作机制。
12. 简述 TCP 首部结构中 URG、ACK、PSH、RST、SYN 和 FIN 标志位字段的作用。
13. 简述 TCP 建立连接的“三次握手”过程和拆除连接的“四次握手”过程。
14. 简述 TCP 流量控制的基本原理。
15. TCP 拥塞控制的基本算法有哪些？
16. 简述“加性增加，乘性减小”的 AIMD 算法的基本思想。
